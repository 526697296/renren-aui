<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>renren-aui</title>
  <link rel="stylesheet" href="../element-theme/blue/index.css">
  <link rel="stylesheet" href="../css/aui.min.css">
  <link rel="stylesheet" href="../css/skins/blue.min.css">
</head>
<body>
  <div class="aui-wrapper" :class="{ 'aui-aside--fold': asideFold }" v-loading.fullscreen.lock="loading" element-loading-text="拼命加载中">
    <template v-if="!loading">
      <!-- aui-header -->
      <header class="aui-header" :class="'aui-header--' + headerSkin">
        <div class="aui-header__hd">
          <h1 class="aui-brand">
            <a class="aui-brand--lg" href="javascript:;">renren-aui</a>
            <a class="aui-brand--sm" href="javascript:;">aui</a>
          </h1>
        </div>
        <div class="aui-header__bd">
          <el-menu class="aui-header__menu mr-auto" mode="horizontal">
            <el-menu-item index="1" @click="asideFold = !asideFold">
              <svg class="icon-svg aui-header__icon-menu aui-header__icon-menu--switch" aria-hidden="true"><use xlink:href="#icon-outdent"></use></svg>
            </el-menu-item>
            <el-menu-item index="2">
              <a href="//www.renren.io/" target="_blank">
                <svg class="icon-svg aui-header__icon-menu" aria-hidden="true"><use xlink:href="#icon-earth"></use></svg>
              </a>
            </el-menu-item>
            <el-menu-item index="3" @click="refreshHandle()">
              <svg class="icon-svg aui-header__icon-menu aui-header__icon-menu--refresh" aria-hidden="true"><use xlink:href="#icon-sync"></use></svg>
            </el-menu-item>
            <el-submenu index="4">
              <template slot="title"><i class="el-icon-location"></i>我的工作台</template>
              <el-menu-item index="2-1">选项1</el-menu-item>
              <el-menu-item index="2-2">选项2</el-menu-item>
              <el-menu-item index="2-3">选项3</el-menu-item>
              <el-submenu index="2-4">
                <template slot="title">选项4</template>
                <el-menu-item index="2-4-1">选项1</el-menu-item>
                <el-menu-item index="2-4-2">选项2</el-menu-item>
                <el-menu-item index="2-4-3">选项3</el-menu-item>
              </el-submenu>
            </el-submenu>
          </el-menu>
          <el-menu class="aui-header__menu" mode="horizontal">
            <el-menu-item index="1" class="aui-header__search">
              <a href="javascript:;" @click="searchVisible = !searchVisible">
                <svg class="aui-header__icon-menu icon-svg" aria-hidden="true"><use xlink:href="#icon-search"></use></svg>
              </a>
              <el-autocomplete
                v-model="searchValue"
                :fetch-suggestions="searchSuggestionsHandle"
                placeholder="请输入内容"
                class="aui-header__search-txt" :class="{ 'is-show': searchVisible }">
              </el-autocomplete>
            </el-menu-item>
            <el-menu-item index="2" @click="fullscreenHandle()">
              <svg class="aui-header__icon-menu icon-svg" aria-hidden="true"><use xlink:href="#icon-fullscreen"></use></svg>
            </el-menu-item>
            <el-submenu index="3">
              <template slot="title">
                <img class="aui-avatar" src="../img/avatar.png">
                <span>{{ user.name }}</span>
              </template>
              <el-menu-item index="2-1">修改密码</el-menu-item>
              <el-menu-item index="2-2">退出</el-menu-item>
            </el-submenu>
            <el-menu-item index="4">
              <el-dropdown placement="bottom">
                <span class="el-dropdown-link">
                  <img class="aui-avatar" src="../img/avatar.png">
                  <span>{{ user.name }}</span>
                  <i class="el-icon-arrow-down"></i>
                </span>
                <span></span>
                <el-dropdown-menu slot="dropdown">
                  <el-dropdown-item @click.native="updatePasswordHandle()">修改密码</el-dropdown-item>
                  <el-dropdown-item @click.native="logoutHandle()">退出</el-dropdown-item>
                </el-dropdown-menu>
              </el-dropdown>
            </el-menu-item>
          </el-menu>
        </div>
        <!-- 弹窗, 修改密码 -->
        <el-dialog
          title="修改密码"
          :visible.sync="updatePasswordVisible"
          :append-to-body="true">
          <el-form :model="updatePasswordDataForm" :rules="updatePasswordDataRule" ref="updatePasswordDataForm" @keyup.enter.native="updatePasswordDataFormSubmit()" label-width="80px">
            <el-form-item label="账号">
              <span>{{ user.name }}</span>
            </el-form-item>
            <el-form-item label="原密码" prop="password">
              <el-input type="password" v-model="updatePasswordDataForm.password" placeholder="原密码"></el-input>
            </el-form-item>
            <el-form-item label="新密码" prop="newPassword">
              <el-input type="password" v-model="updatePasswordDataForm.newPassword" placeholder="新密码"></el-input>
            </el-form-item>
            <el-form-item label="确认密码" prop="confirmPassword">
              <el-input type="password" v-model="updatePasswordDataForm.confirmPassword" placeholder="确认密码"></el-input>
            </el-form-item>
          </el-form>
          <span slot="footer" class="dialog-footer">
            <el-button @click="updatePasswordVisible = false">取消</el-button>
            <el-button type="primary" @click="updatePasswordDataFormSubmit()">确定</el-button>
          </span>
        </el-dialog>
      </header>
      <!-- aui-aside -->
      <aside class="aui-aside" :class="'aui-aside--' + asideSkin">
        <div class="aui-aside__inner">
          <el-menu
            :default-active="asideMenuActiveName"
            :collapse="asideFold"
            :unique-opened="true"
            :collapse-transition="false"
            class="aui-aside__menu">
            <aui-aside-submenu
              v-for="menu in asideMenuList"
              :key="menu.id"
              :menu="menu"
              :aside-skin="asideSkin">
            </aui-aside-submenu>
          </el-menu>
        </div>
      </aside>
      <!-- aui-main -->
      <main class="aui-main" :class="{ 'aui-main--tabs': isTab }">
        <el-row>
          <el-button>默认按钮</el-button>
          <el-button type="primary">主要按钮</el-button>
          <el-button type="success">成功按钮</el-button>
          <el-button type="info">信息按钮</el-button>
          <el-button type="warning">警告按钮</el-button>
          <el-button type="danger">危险按钮</el-button>
        </el-row>
      </main>
      <!-- aui-footer -->
      <footer class="aui-footer">
        aui-footer
      </footer>
      <!-- aui-skin-tools -->
      <div class="aui-theme-tools" :class="{ 'aui-theme-tools--open': themeToolsIsOpen }">
        <div class="aui-theme-tools__toggle" @click="themeToolsIsOpen = !themeToolsIsOpen">
          <svg class="icon-svg" aria-hidden="true"><use xlink:href="#icon-setting"></use></svg>
        </div>
        <div class="aui-theme-tools__content">
          <div class="aui-theme-tools__item">
            <h3>Header</h3>
            <el-checkbox v-model="headerSkin" true-label="colorful">colorful 鲜艳</el-checkbox>
          </div>
          <div class="aui-theme-tools__item">
            <h3>Aside</h3>
            <el-checkbox v-model="asideSkin" true-label="dark">dark 黑色</el-checkbox>
          </div>
          <div class="aui-theme-tools__item">
            <h3>Theme</h3>
            <el-radio-group v-model="themeColor" @change="themeColorChangeHandle">
              <el-radio v-for="item in themeList" :key="item.name" :label="item.name">{{ item.name }} {{ item.desc }}</el-radio>
            </el-radio-group>
          </div>
        </div>
      </div>
    </template>
  </div>
  <script src="../plugins/vue-2.5.17/vue.js"></script>
  <script src="../plugins/element-2.4.5/index.js"></script>
  <script src="../plugins/es6-promise-4.2.4/es6-promise.auto.min.js"></script>
  <script src="../plugins/axios-0.18.0/axios.min.js"></script>
  <script src="../plugins/js-cookie-2.2.0/js-cookie.min.js"></script>
  <script src="../plugins/lodash-4.17.10/lodash.min.js"></script>
  <script src="../plugins/qs-6.5.2/qs.min.js"></script>
  <script src="../icons/iconfont.js"></script>
  <script src="../plugins/screenfull-3.3.2/screenfull.min.js"></script>
  <script>
    Vue.prototype.$ELEMENT = { size: 'medium' };
  </script>
  <script>
  (function () {
    var vm = window.vm = new Vue({
      el: '.aui-wrapper',
      data: function () {
        return {
          loading: true,
          // 头部, 布局皮肤, white(白色) / colorful(鲜艳)
          headerSkin: 'white',
          // 侧边, 布局皮肤, white(白色) / dark(黑色)
          asideSkin: 'white',
          // 侧边, 折叠状态
          asideFold: false,
          // 侧边, 菜单
          asideMenuList: [],
          asideMenuActiveName: '',
          // 内容是否通过tab展示
          isTab: true,
          // 内容标签页
          contentTabs: [],
          contentTabsActiveName: '',
          // 用户信息
          user: {
            id: 0,
            name: ''
          },
          // 搜索
          searchVisible: false,
          searchValue: '',
          // 修改密码
          updatePasswordVisible: false,
          updatePasswordDataForm: {
            password: '',
            newPassword: '',
            confirmPassword: ''
          },
          updatePasswordDataRule: {
            password: [
              { required: true, message: '必填项不能为空', trigger: 'blur' }
            ],
            newPassword: [
              { required: true, message: '必填项不能为空', trigger: 'blur' }
            ],
            confirmPassword: [
              { required: true, message: '必填项不能为空', trigger: 'blur' }
            ]
          },
          themeToolsIsOpen: false,
          themeList: [],
          themeColor: 'turquoise'
        }
      },
      beforeCreate () {
        vm = this;
      },
      created () {
        axios.get('../skins.json').then(function (res) {
          vm.themeList = res.data;
        });
        axios.all([
          vm.getUserInfo(),
          vm.getMenuList()
        ]).then(function () {
          vm.loading = false;
          // 注册组件, 侧边栏子菜单
          fnRegistrationAuiSidebarSubmenu();
          // 监听, tab添加事件
          vm.$on('tabAddHandle', vm.tabAddHandle);
          // 初始默认选中菜单
          vm.contentTabs.push({
            'name': '1001',
            'title': '分析页',
            'isTabClosable': false,
            'isIframe': true,
            'url': './modules/dashboard/analysis.html'
          });
          vm.sidebarMenuActiveName = '1001';
          vm.contentTabsActiveName = '1001';
        });
      },
      mounted () {
        // 窗口resize实现媒体查询
        vm.asideFold = document.documentElement['clientWidth'] <= 992 || false;
        window.addEventListener('resize', _.debounce(function () {
          vm.asideFold = document.documentElement['clientWidth'] <= 992 || false;
        }, 150));
      },
      methods: {
        themeColorChangeHandle (val) {
          var styleList = [
            {
              id: 'J_elementTheme',
              url: '../element-theme/' + val + '/index.css?t=' + new Date().getTime()
            },
            {
              id: 'J_auiTheme',
              url: '../element-theme/' + val + '/aui.css?t=' + new Date().getTime()
            }
          ]
          for (var i = 0; i < styleList.length; i++) {
            var el = document.querySelector('#' + styleList[i].id)
            if (el) {
              el.href = styleList[i].url
              continue
            }
            el = document.createElement('link')
            el.id = styleList[i].id
            el.href = styleList[i].url
            el.rel = 'stylesheet'
            document.querySelector('head').appendChild(el)
          }
        },
        // 获取当前管理员信息
        getUserInfo: function () {
          return axios.get('../mock/sys-user-info.json').then(function (res) {
            if (res.data && res.data.code === 0) {
              vm.user.id = res.data.user.userId;
              vm.user.name = res.data.user.username;
            }
          });
        },
        // 获取菜单列表
        getMenuList: function () {
          return axios.get('../mock/sys-menu-nav.json').then(function (res) {
            if (res.data && res.data.code === 0) {
              vm.sidebarMenuList = res.data.data;
            }
          })
        },
        // 刷新
        refreshHandle () {
          var iframeBox = document.querySelector('#pane-' + vm.contentTabsActiveName + ' iframe');
          if (iframeBox) {
            iframeBox.contentWindow.location.reload(true);
          }
        },
        // 搜索提示
        searchSuggestionsHandle (queryString, cb) {
          cb([
            { value: '搜索提示一' },
            { value: '搜索提示二' },
            { value: '搜索提示三' }
          ]);
        },
        // 全屏
        fullscreenHandle () {
          if (!screenfull.enabled) {
            return vm.$message({
              message: '您的浏览器不支持此操作',
              type: 'warning',
              duration: 1500
            });
          }
          screenfull.toggle();
        },
        // 修改密码
        updatePasswordHandle () {
          vm.updatePasswordVisible = true;
          vm.$nextTick(function () {
            vm.$refs['updatePasswordDataForm'].resetFields();
          });
        },
        // 修改密码, 表单提交
        updatePasswordDataFormSubmit () {
          vm.$refs['updatePasswordDataForm'].validate(function (valid) {
            if (valid) {
              vm.$message({
                message: '操作成功：' + JSON.stringify({
                  password: vm.updatePasswordDataForm.password,
                  newPassword: vm.updatePasswordDataForm.newPassword,
                  confirmPassword: vm.updatePasswordDataForm.confirmPassword
                }),
                type: 'success',
                duration: 1500,
                onClose: function () {
                  vm.updatePasswordVisible = false;
                }
              });
            }
          });
        },
        // 退出
        logoutHandle () {
          this.$confirm(`确定进行[退出]操作?`, '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(function () {
            window.location.href = './login.html';
          }).catch(function () {});
        },
        // tabs, 添加tab
        tabAddHandle (menu) {
          var tab = vm.contentTabs.filter(function (item) {
            return item.name === menu.id + '';
          })
          if (tab.length <= 0) {
            tab = {
              'name': menu.id + '',
              'title': menu.title,
              'isTabClosable': true,
              'isIframe': true,
              'url': menu.url
            }
            vm.contentTabs = vm.contentTabs.concat(tab);
          } else {
            tab = tab[0];
          }
          vm.sidebarMenuActiveName = vm.contentTabsActiveName = tab.name;
        },
        // tabs, 删除tab
        tabRemoveHandle (tabName) {
          vm.contentTabs = vm.contentTabs.filter(function (item) {
            return item.name !== tabName;
          });
          if (vm.contentTabs.length >= 1) {
            // 当前选中tab被删除
            if (tabName === vm.contentTabsActiveName) {
              vm.sidebarMenuActiveName = vm.contentTabsActiveName = vm.contentTabs[vm.contentTabs.length - 1].name;
            }
          } else {
            vm.sidebarMenuActiveName = '';
            vm.contentTabsActiveName = 'home';
          }
        },
        // tabs, 选中tab
        tabSelectedHandle (tab) {
          tab = vm.contentTabs.filter(function (item) {
            return item.name === tab.name;
          });
          vm.sidebarMenuActiveName = tab.length >= 1 ? tab[0].name : '';
        },
        // tabs, 关闭当前
        tabsCloseCurrentHandle () {
          if (vm.contentTabsActiveName !== 'home') {
            vm.tabRemoveHandle(vm.contentTabsActiveName);
          }
        },
        // tabs, 关闭其它
        tabsCloseOtherHandle () {
          vm.contentTabs = vm.contentTabs.filter(function (item) {
            return item.name === 'home' || item.name === vm.contentTabsActiveName;
          });
        },
        // tabs, 关闭全部
        tabsCloseAllHandle () {
          vm.contentTabs = vm.contentTabs.filter(function (item) {
            return item.name === 'home';
          });
          vm.sidebarMenuActiveName = '';
          vm.contentTabsActiveName = 'home';
        }
      }
    });

    /**
    * 注册组件, 侧边栏子菜单
    */
    function fnRegistrationAuiSidebarSubmenu () {
      Vue.component('aui-aside-submenu', {
        template: '\
          <el-submenu\
            v-if="menu.children && menu.children.length >= 1"\
            :index="menu.id + \'\'"\
            :popper-class="\'aui-aside--\' + asideSkin + \'-popper\'">\
            <template slot="title">\
              <svg class="aui-aside__menu-icon icon-svg" aria-hidden="true"><use :xlink:href="\'#\' + (menu.icon || \'icon-yuanquan\')"></use></svg>\
              <span>{{ menu.title }}</span>\
            </template>\
            <aui-aside-submenu\
              v-for="item in menu.children"\
              :key="item.id"\
              :menu="item"\
              :aside-skin="asideSkin">\
            </aui-aside-submenu>\
          </el-submenu>\
          <el-menu-item v-else :index="menu.id + \'\'" @click="tabAddHandle(menu)">\
            <svg class="aui-aside__menu-icon icon-svg" aria-hidden="true"><use :xlink:href="\'#\' + (menu.icon || \'icon-yuanquan\')"></use></svg>\
            <span>{{ menu.title }}</span>\
          </el-menu-item>',
        props: {
          menu: {
            type: Object,
            required: true
          }
        },
        computed: {
          asideLayoutSkin: function () {
            return vm.asideLayoutSkin;
          }
        },
        methods: {
          tabAddHandle (menu) {
            vm.$emit('tabAddHandle', menu);
          }
        }
      }); 
    };
  })();
</script>
</body>
</html>
